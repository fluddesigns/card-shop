{% extends "base.html" %}
{% block title %}Admin{% endblock %}
{% block content %}
<div class="container-fluid mt-3">
    {% with messages = get_flashed_messages() %}
    {% if messages %}<div class="alert alert-warning p-2">{{ messages[0] }}</div>{% endif %}
    {% endwith %}

    <div class="row g-3 mb-3">
        <!-- Settings -->
        <div class="col-md-3">
            <div class="card h-100">
                <div class="card-header bg-dark text-white py-2">Config</div>
                <div class="card-body py-2">
                    <form action="{{ url_for('update_settings') }}" method="POST">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" name="show_prices" {% if settings.show_prices %}checked{% endif %}>
                            <label class="form-check-label small">Public Prices</label>
                        </div>
                        <button type="submit" class="btn btn-sm btn-outline-dark mt-2 w-100">Save</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Quick Add -->
        <div class="col-md-4">
            <div class="card h-100 border-primary">
                <div class="card-header bg-primary text-white py-2">Quick Add</div>
                <div class="card-body py-2">
                    <form action="{{ url_for('add_card') }}" method="POST">
                        <div class="input-group input-group-sm mb-2">
                            <select name="game" class="form-select" style="max-width:30%"><option>Magic: The Gathering</option><option>Pokemon TCG</option></select>
                            <input type="text" name="card_name" class="form-control" placeholder="Card Name" required>
                        </div>
                        <div class="input-group input-group-sm mb-2">
                            <input type="text" name="set_name" class="form-control" placeholder="Set" required>
                            <input type="number" name="price" class="form-control" placeholder="$0.00" step="0.01">
                        </div>
                        <button class="btn btn-primary btn-sm w-100">Add Single Card</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Import -->
        <div class="col-md-5">
            <div class="card h-100">
                <div class="card-header bg-secondary text-white py-2">
                    <ul class="nav nav-tabs card-header-tabs" id="tabs" role="tablist">
                        <li class="nav-item"><button class="nav-link active text-dark p-1 px-3" data-bs-toggle="tab" data-bs-target="#paste">Paste</button></li>
                        <li class="nav-item"><button class="nav-link text-dark p-1 px-3" data-bs-toggle="tab" data-bs-target="#csv">CSV</button></li>
                    </ul>
                </div>
                <div class="card-body py-2">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="paste">
                            <form action="{{ url_for('paste_import') }}" method="POST">
                                <textarea name="paste_data" class="form-control form-control-sm mb-1" rows="2" placeholder="1 Sol Ring [CMM] 415"></textarea>
                                <select name="game_mode" class="form-select form-select-sm mb-1"><option value="magic">Magic</option><option value="pokemon">Pokemon</option></select>
                                <button class="btn btn-secondary btn-sm w-100">Import Text</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="csv">
                            <form action="{{ url_for('upload_csv') }}" method="post" enctype="multipart/form-data">
                                <input class="form-control form-control-sm mb-2" type="file" name="file" accept=".csv" required>
                                <button class="btn btn-outline-secondary btn-sm w-100">Upload File</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Inventory Table -->
    <div class="card">
        <div class="card-body p-0">
            <table id="admTable" class="table table-striped table-bordered dt-responsive nowrap w-100">
                <thead><tr><th>Name</th><th>Set</th><th>$$</th><th>Qty</th><th>Act</th></tr></thead>
                <tbody>
                    {% for card in inventory %}
                    <tr>
                        <td>{{ card.card_name }} <small class="text-muted">{{ card.game }}</small></td>
                        <td>{{ card.set_name }}</td>
                        <form action="{{ url_for('update_card', id=card.id) }}" method="POST">
                        <td><input type="number" step="0.01" name="price" value="{{ card.price }}" class="form-control form-control-sm" style="width:70px"></td>
                        <td><input type="number" name="quantity" value="{{ card.quantity }}" class="form-control form-control-sm" style="width:50px"></td>
                        <td>
                            <button type="submit" name="action" value="update_details" class="btn btn-success btn-sm p-0 px-1">💾</button>
                            <button type="submit" name="action" value="delete" class="btn btn-danger btn-sm p-0 px-1" onclick="return confirm('Delete?')">✕</button>
                        </td>
                        </form>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script>$(document).ready(function(){ $('#admTable').DataTable({responsive:true, order:[[0,'desc']]}); });</script>
{% endblock %}